<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ - Alkawthar Drive</title>

  <!-- CSS PRINCIPAL -->
  <link rel="stylesheet" href="assets/css/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

  <div class="chauffeur-container">
    <h2>ğŸš– ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¦Ù‚ - Alkawthar Drive</h2>

    <form id="chauffeurForm" enctype="multipart/form-data">

      <label>Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨</label>
      <input type="text" name="nom" id="ch-nom" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input type="tel" name="telephone" id="ch-telephone" required placeholder="Ù…Ø«Ø§Ù„: 0555xxxxxx">

      <label>ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</label>
      <input type="file" name="photo" id="ch-photo" accept="image/*" capture="camera" required>

      <label>ğŸ“„ ØµÙˆØ±Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© (Carte Grise)</label>
      <input type="file" name="carteGrise" id="ch-carte-grise" accept="image/*,application/pdf" required>

      <label>ğŸ“„ ØµÙˆØ±Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø³Ø§Ø±ÙŠ Ø§Ù„Ù…ÙØ¹ÙˆÙ„</label>
      <input type="file" name="assurance" id="ch-assurance" accept="image/*,application/pdf" required>

      <label>ğŸš— ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙˆØ§Ø¶Ø­Ø©)</label>
      <input type="file" name="vehicule" id="ch-vehicule" accept="image/*" capture="camera" required>

      <button type="submit" id="submitBtn">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>

    </form>

    <br>
    <button onclick="window.location.href='index.html'">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†</button>
  </div>

  <!-- ================== SCRIPT BACKEND ================== -->
  <script>
    document.getElementById("chauffeurForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

      const formData = new FormData(this);

      try {
        const response = await fetch('https://alkawthar-drive.onrender.com/api/chauffeur', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (result.success) {
          alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ù†Ø¬Ø§Ø­!");
          document.getElementById("chauffeurForm").reset();
        } else {
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + (result.error || "Unknown error"));
        }
      } catch (error) {
        console.error("Error:", error);
        alert("âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù….");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "âœ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
      }
    });
  </script>

</body>

</html>
